@model ResultBlogDto
@using Blogy.Entity.Entities
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@{
	ViewData["Title"] = "BlogDetails";
	Layout = "~/Views/UILayout/Index.cshtml";
}

<div class="site-cover site-cover-sm same-height overlay single-page" style="background-image: url('@Model.CoverImage');">
	<div class="container">
		<div class="row same-height justify-content-center">
			<div class="col-md-6">
				<div class="post-entry text-center">
					<h1 class="mb-4">@Model.Title</h1>
					<div class="post-meta align-items-center text-center">
						<figure class="author-figure mb-0 me-3 d-inline-block"><img src="@Model.Writer.ImageUrl" alt="Image" class="img-fluid"></figure>
						<span class="d-inline-block mt-1">@Model.Writer.FullName</span>
						<span>&nbsp;-&nbsp; @Model.CreatedDate</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<section class="section">
	<div class="container">

		<div class="row blog-entries element-animate">

			<div class="col-md-12 col-lg-8 main-content">

				<div class="post-content-body">

					<div class="row my-4">
						<div class="col-md-12 mb-4">
							<img src="@Model.CoverImage" alt="Image placeholder" class="img-fluid rounded">
						</div>
						<div class="col-md-6 mb-4">
							<img src="@Model.BlogImage1" alt="Image placeholder" class="img-fluid rounded">
						</div>
						<div class="col-md-6 mb-4">
							<img src="@Model.BlogImage2" alt="Image placeholder" class="img-fluid rounded">
						</div>
					</div>
					<p>@Model.Description</p>

				</div>

				<div class="pt-5">
					<p>
						Kategori:  <a href="#">@Model.Category.CategoryName</a>
					</p>
				</div>


				<div class="pt-5 comment-wrap">
					<h3 class="mb-5 heading">@Model.Comments.Count() Yorum</h3>
					<ul class="comment-list">
						@foreach (var comment in Model.Comments)
						{
							@if (comment.CommentStatus == "Yorum Onaylandı")
							{
								<li class="comment">
									<div class="vcard">
										<img src="@comment.User.ImageUrl" alt="Image placeholder">
									</div>
									<div class="comment-body">
										<h3>@comment.User.FullName</h3>
										<div class="meta">@comment.CreatedDate</div>
										<p>@comment.Content</p>
									</div>
								</li>
							}
						}
					</ul>
					<!-- END comment-list -->

					<div class="comment-form-wrap pt-5">
						<h3 class="mb-5">Yorum Ekle</h3>



						@if (SignInManager.IsSignedIn(User))
						{
							<form asp-controller="Blog" asp-action="CreateComment" method="post" class="p-5 bg-light">
								<input type="hidden" asp-for="Id" />
								<input type="hidden" name="returnUrl" value="@ViewData["ReturnUrl"]" />
								<label name="Content">Yorumunuz</label>
								<textarea type="text" name="Content" class="form-control" rows="5"></textarea>
								<br />
								<button type="submit" class="btn btn-outline-primary">Yorum Yap</button>
							</form>
						}
						else
						{
							<div class="p-5 bg-light">
								<p>Yorum yapmak için lütfen <a asp-controller="Login" asp-action="Index" 
																asp-route-returnUrl="@Url.Action("BlogDetails", "Blog", new { id = Model.Id })">Giriş yapın</a>.</p>
							</div>
						}

					</div>

				</div>

			</div>

			<!-- END main-content -->

			<div class="col-md-12 col-lg-4 sidebar">
				<div class="sidebar-box search-form-wrap">
					<form action="#" class="sidebar-search-form">
						<span class="bi-search"></span>
						<input type="text" class="form-control" id="s" placeholder="Type a keyword and hit enter">
					</form>
				</div>

				@await Component.InvokeAsync("_BlogsByCategoryLatestBlogsComponent")

				@await Component.InvokeAsync("_CategoryWithCount")

				<div class="sidebar-box">
					<h3 class="heading">Tags</h3>
					<ul class="tags">
						@foreach (var tag in Model.BlogTags)
						{
							<li><a href="#">@tag.Tag.Name</a></li>
						}
					</ul>
				</div>
			</div>
			<!-- END sidebar -->

		</div>
	</div>
</section>